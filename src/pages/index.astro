---
import ButtonLink from '@components/control/ButtonLink.astro';
import HomeSider from '@components/layout/HomeSider.astro';
import PostList from '@components/post/PostList.astro';
import Cover from '@components/ui/cover/Cover.astro';
import { HomeSiderType } from '@constants/enum';
import { getSiteConfig } from '@constants/site-config-i18n';
import { getTranslations } from '@i18n/index';
import Layout from '@layouts/Layout.astro';
import TwoColumnLayout from '@layouts/TwoColumnLayout.astro';
import { getSortedPosts } from '@lib/content';
import { getLocalizedUrl } from '@lib/i18n';
import { Icon } from 'astro-icon/components';
import type { SupportedLanguage } from '@types/i18n';
import { getLanguageFromUrl } from '@lib/i18n';

const currentLanguage: SupportedLanguage = getLanguageFromUrl(Astro.url) || 'zh-CN';
const translations = getTranslations(currentLanguage);
const siteConfig = getSiteConfig(currentLanguage);
const postCollections = await getSortedPosts();
const posts = postCollections.slice(0, 5);
---

<Layout title={siteConfig.title} description={siteConfig.description} siderType={HomeSiderType.HOME} lang={currentLanguage}>
  <TwoColumnLayout>
    <Cover slot="cover" />
    <HomeSider slot="sider" />
    <div class="shadow-box bg-gradient-start tablet:shadow-none flex flex-col gap-4 overflow-hidden p-4 pt-8 md:px-1 md:py-2">
      <PostList posts={posts} showPaginator={false} />
    </div>
    <div class="flex w-full flex-col items-center">
      <ButtonLink
        variant="gradient-shoka"
        url={getLocalizedUrl('/posts', currentLanguage)}
        size="lg"
        label={translations.archive.allPosts}
        className="mt-10 items-center"
      >
        {translations.archive.allPosts}
        <Icon name="gg:format-justify" />
      </ButtonLink>
    </div>
  </TwoColumnLayout>
</Layout>
