---
import { getAvailableLanguages, getArticleLanguageSwitchLinks } from '@lib/article-i18n';
import { getLanguageFromUrl } from '@lib/i18n';
import { LANGUAGE_INFO } from '@constants/i18n';
import type { BlogPost } from 'types/blog';

interface Props {
  post: BlogPost;
}

const { post } = Astro.props;

// 获取当前语言
const currentLanguage = getLanguageFromUrl(Astro.url);

// 获取文章的可用语言和切换链接
const languageLinks = getArticleLanguageSwitchLinks(post, currentLanguage);
---

<div class="article-language-selector mt-4 border-t border-gray-200 pt-4 dark:border-gray-700">
  <h3 class="mb-2 text-lg font-semibold">Available languages:</h3>
  <div class="flex flex-wrap gap-2">
    {
      languageLinks.map(({ language, url, isCurrent }) => {
        const languageInfo = LANGUAGE_INFO[language];
        return (
          <a
            href={url}
            class={`rounded-full px-3 py-1 text-sm font-medium transition-colors ${
              isCurrent
                ? 'bg-blue-500 text-white'
                : 'bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600'
            }`}
            aria-label={`Switch to ${languageInfo?.nativeName || language}`}
          >
            {languageInfo?.nativeName || language}
          </a>
        );
      })
    }
  </div>
</div>
